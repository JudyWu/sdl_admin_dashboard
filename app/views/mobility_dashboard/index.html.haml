%head
  = javascript_include_tag "draw", "dsu"

:sass
  $navy-blue: #2c3e50
  $light-gray: #ecf0f1
  $font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif
  $walking-distance: #FFAC46
  $away-from-home: #46D1FF
  $max-speed: #6EEDA5


  .timeline
    margin-top: 20px

  .selected
    opacity: 1

  .unselected
    opacity: 0.3

  .bottom-area
    padding-top: 2em
    padding-bottom: 2em

  .pager li
    display: inline

  .padding
    padding: 1.5em

  .li-style
    list-style-type: none
    padding-top: 1em
    padding-bottom: 1em

  %body
    width: 100%
    height: 100%
    min-height: 100%
    background: $navy-blue

  .mobility-page
    background: $navy-blue
    color: white



  .dashed_border
    text-align: center
    background-color: #2c3e50
    height: 5em
    border-top-style: dashed
    border-left-style: solid
    border-right-style: dashed
    border-bottom-style: dashed
    font-family: $font-family
    font-size: 1em
    font-weight: bold

  .solid_border
    text-align: center
    height: 5em
    border-top-style: solid
    border-bottom-style: solid
    color: #2c3e50
    font-family: $font-family
    font-size: 1em
    font-weight: bold

  .border_left_color
    border-left-color: #2c3e50
    border-left-style: dashed

  .distance-color
    background-color: $walking-distance
    border-top-color: $walking-distance
    border-bottom-color: $walking-distance

  .distance
    color: $walking-distance

  .away-color
    background-color: $away-from-home
    border-top-color: $away-from-home
    border-bottom-color: $away-from-home

  .away
    color: $away-from-home

  .speed-color
    background-color: $max-speed
    border-top-color: $max-speed
    border-bottom-color: $max-speed

  .speed
    color: $max-speed




  .width_100
    width: 100%



%body
  .mobility-page
    .top-bar
      .row
        .col-md-10.col-md-offset-1.col-sm-10.col-sm-offset-1.col-sx-10.col-sx-offset-1
          .name
            %h1.text-left Mobility-omh

          .info
            #user_name
            #selected_date
            #previous_date
            #next_date

          %hr
    .row
      .col-md-4.col-md-offset-2.col-sm-4.col-sm-offset-2.col-sx-4.col-sx-offset-2
        .btn-group
          %button.btn.btn-primary.btn-device.selected{type: 'button', data: 'android'} Android
          %button.btn.btn-success.btn-device.unselected{type: 'button', data: 'ios'} iPhone
          %button.btn.btn-device.unselected{type: 'button', data: 'moves-app'} Moves

    -# .row
    -#   .col-md-8.col-md-offset-2
    -#     %nav
    -#       %ul.pager
    -#         %li
    -#           %a#previous_day_button{href: ''} Previous Day

    -#         %li
    -#           %a#selected_date

    -#         %li
    -#           %a#next_day_button{href: ''} Next Day


    .bottom-area
      .date-area
        .row
          .col-md-4.col-md-offset-4.col-sm-4.col-sm-offset-4.col-sx-4.col-sx-offset-4
            .input-group.date
              %input.form-control
                %span.input-group-addon
                  %i.glyphicon.glyphicon-th



      .location-area
        .location-image-set
          .row
            .col-md-10.col-md-offset-1.col-sm-10.col-sm-offset-1.col-sx-10.col-sx-offset-1
              %h3.text-left Location for the day
              .row
                .col-sm-8.col-sm-offset-1
                  %ul#google_locations



            .timeline#timeline
            #map

            .start_time
            .end_time


      .testing-area
        .row
          .col-md-10.col-md-offset-1.col-sm-10.col-sm-offset-1.col-sx-10.col-sx-offset-1
            %h3 Activities for the day
        .row
          .col-md-8.col-md-offset-2.col-sm-8.col-sm-offset-2.col-sx-8.col-sx-offset-2
            .row
              .col-sm-3
                %h4 Walking Distance (miles)
                %p#walking-distance
              .col-sm-9
                %table
                  %tr#distance_bar.padding

        .row
          .col-md-8.col-md-offset-2.col-sm-8.col-sm-offset-2.col-sx-8.col-sx-offset-2
            .row
              .col-sm-3
                %h4 Fastest Speed (miles/second)
                %p#gait-speed
              .col-sm-9
                %table
                  %tr#speed_bar.padding

        .row
          .col-md-8.col-md-offset-2.col-sm-8.col-sm-offset-2.col-sx-8.col-sx-offset-2
            .row
              .col-sm-3
                %h4 Away from Home (hours)
                %p#away-from-home
              .col-sm-9
                %table
                  %tr#away_bar.padding



:javascript
    $(document).ready( function() {

        var datepicker =
        $('.date').datepicker({
            format: "yyyy-mm-dd",
            todayHighlight: true
        });

        var token = url("#access_token");

        if(!token)
        {
            window.location.href = dsu + "oauth/authorize?client_id=mobility-visualization&response_type=token";
        }
        else
        {
            $.getJSON(dsu + "oauth/check_token?token=" + token)
            .done(function(data) {
                var username = data["user_name"];
                var device = url("#device") || "android";
                var date = url("#date")? moment(url("#date")).toDate() : new Date();
                var redraw = function(){
                    deletePreviousImg();
                    drawDate(username, moment(date).format('YYYY-MM-DD'), device, token);
                    deletePreviousBar();
                    showSummary(username, date, device, token);
                };

                $('.btn-device').click(function(e){
                   $(".btn-group button").removeClass("selected").addClass("unselected");
                    var btn = $(e.target);
                    device = btn.attr("data");
                    btn.removeClass("unselected").addClass("selected");
                    redraw();
                });
                datepicker.on("changeDate", function(e){
                    date = e.date;
                    redraw();
                });
                $('.date').datepicker("setDate", date);
            })
            .fail(function() {
                window.location.href = dsu + "oauth/authorize?client_id=mobility_visualization&response_type=token";
            });

        }
    } );



